# Typefully Integration Guide

This guide covers the Typefully integration for creating Twitter/X threads from patch notes.

## Overview

The Typefully integration allows you to:
- Queue patch notes as Twitter/X threads
- Include auto-generated videos in threads
- Schedule posts for optimal engagement times
- Track publishing status and thread URLs

## Setup

### Prerequisites

1. **Typefully Account**: Sign up at [typefully.com](https://typefully.com)
2. **Connected Twitter/X Account**: Link your Twitter/X account in Typefully settings
3. **API Key**: Generate an API key from Typefully Settings > API

### Configuration

1. Navigate to **Integrations** in Repatch
2. Click on **Typefully** card
3. Click **Connect**
4. Enter your Typefully API key
5. Save the configuration

## Usage

### Queueing a Thread

1. Navigate to any patch note page
2. Click **Queue Twitter Thread** button
3. If no video exists, you'll be prompted to generate one
4. The thread will be created as a draft in Typefully
5. You'll receive a link to view/edit the draft on Typefully

### Thread Format

Patch notes are automatically converted to Twitter threads:
- **First Tweet**: Title, statistics, and repository info
- **Body Tweets**: Content split into 280-character chunks
- **Final Tweet**: Contributors acknowledgment
- **Threading**: Automatic numbering ([1/n], [2/n], etc.)

Example thread structure:
```
[1/5] 🚀 Weekly Update: Major Performance Improvements

📊 1,234 lines added, 567 removed
👥 12 contributors
🔗 yourrepo/project

[2/5] ✨ Key Highlights:
• Reduced API response time by 40%
• Fixed critical memory leak in worker threads
• Added new caching layer

[3/5] 🔧 Infrastructure Updates:
• Migrated to Node.js 20 LTS
• Updated all dependencies
• Improved CI/CD pipeline

[4/5] 🐛 Bug Fixes:
• Resolved user authentication issues
• Fixed data export functionality
• Corrected timezone handling

[5/5] Thanks to: @contributor1, @contributor2, @contributor3 and 9 more
```

## API Limitations

### Typefully API

- **Rate Limits**: 60 requests per minute
- **Draft Limits**: Depends on your Typefully plan
- **Media Uploads**: Video files must be < 512MB
- **Thread Length**: Max 25 tweets per thread

### Video Requirements

- **Format**: MP4 (H.264 codec)
- **Max Size**: 512MB
- **Duration**: Up to 2:20 (140 seconds)
- **Resolution**: 2160x1080 (generated by Remotion)

## Database Schema

The integration uses two tables:

### `typefully_configs`
Stores API credentials and configuration:
- `api_key`: Encrypted Typefully API key
- `auto_thread`: Whether to auto-thread long content
- `schedule_time`: Default scheduling time
- `twitter_username`: Cached Twitter username

### `typefully_jobs`
Tracks thread queue jobs:
- `patch_note_id`: Reference to patch note
- `typefully_draft_id`: Typefully draft ID
- `thread_content`: Array of tweet texts
- `status`: pending, queued, scheduled, published, failed
- `scheduled_for`: When the thread is scheduled
- `published_at`: When the thread was published

## Troubleshooting

### Common Issues

1. **"Typefully not configured"**
   - Solution: Add your API key in Integrations > Typefully

2. **"Failed to create draft"**
   - Check API key validity
   - Verify Typefully account has Twitter connected
   - Check rate limits (wait 1 minute and retry)

3. **Video not included in thread**
   - Ensure video is generated first
   - Check video file size (< 512MB)
   - Verify video format is MP4

4. **Thread too long**
   - Typefully limits threads to 25 tweets
   - Consider creating multiple threads for very long patch notes

### API Error Codes

- `401`: Invalid API key
- `403`: Account limits exceeded
- `429`: Rate limit exceeded (wait 60 seconds)
- `500`: Typefully server error (retry later)

## Best Practices

1. **Timing**: Schedule threads for peak engagement times (usually 9-10 AM or 5-6 PM in your audience's timezone)

2. **Content**: Keep first tweet compelling - it's what users see in their timeline

3. **Videos**: Always include videos when available for higher engagement

4. **Hashtags**: Add relevant hashtags in the last tweet to improve discoverability

5. **Testing**: Use Typefully's preview feature before publishing

## Environment Variables

While the Typefully API key is stored in the database, you can optionally set:

```bash
# Optional: Default scheduling timezone
TYPEFULLY_DEFAULT_TIMEZONE=America/New_York

# Optional: Auto-generate video for threads
TYPEFULLY_AUTO_GENERATE_VIDEO=true
```

## API Reference

### Queue Thread Endpoint

```
POST /api/patch-notes/{id}/queue-thread
```

Request body:
```json
{
  "scheduleFor": "2024-01-15T10:00:00Z", // Optional ISO 8601 datetime
  "includeVideo": true // Optional, defaults to true if video exists
}
```

Response:
```json
{
  "success": true,
  "job": {
    "id": "uuid",
    "status": "queued",
    "typefully_draft_id": "draft_123",
    "typefully_post_url": "https://typefully.com/..."
  },
  "draftUrl": "https://typefully.com/...",
  "threadPreview": ["tweet 1", "tweet 2", "..."]
}
```

### Get Thread Status

```
GET /api/patch-notes/{id}/queue-thread
```

Response:
```json
{
  "jobs": [
    {
      "id": "uuid",
      "status": "queued",
      "created_at": "2024-01-15T09:00:00Z"
    }
  ],
  "hasActiveJob": true
}
```

## Support

For issues with:
- **Typefully API**: Check [Typefully API docs](https://support.typefully.com/en/articles/8718287-typefully-api)
- **Twitter/X limits**: See [Twitter API documentation](https://developer.twitter.com/en/docs)
- **Repatch integration**: Open an issue on GitHub